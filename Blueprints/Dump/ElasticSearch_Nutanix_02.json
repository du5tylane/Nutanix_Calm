{"status":{},"contains_secrets":false,"product_version":"3.1.1","spec":{"description":"","resources":{"client_attrs":{"5c53846f_deployment":{"y":159.7923754617,"x":523.2293398914},"f44d3534_deployment":{"y":368.5000125761,"x":837.9999109998}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure ES"}],"name":"e25e95bd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure ES","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# variable\/macros\nVMNAME=@@{name}@@\nCLUSTER_NAME=\"@@{cluster_name}@@\"\ndeclare -a NODE_IPS\nNODE_IPS=(@@{data_node_ip}@@)\nDATANODES=$(echo ${NODE_IPS} | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n# update yml\nsudo sed -i \"s\/#node.name: node-1\/node.name: $VMNAME\/\" \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#network.host: 192.168.0.1\/network.host: 0.0.0.0\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#http.port: 9200\/http.port: 9200\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i \"s\/#cluster.name: my-application\/cluster.name: $CLUSTER_NAME\/\" \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i \"s\/#discovery.zen.minimum_master_nodes:\/discovery.zen.minimum_master_nodes: 2\/\" \/etc\/elasticsearch\/elasticsearch.yml\necho \"node.master: true\" | sudo tee -a \/etc\/elasticsearch\/elasticsearch.yml\necho \"discovery.zen.ping.unicast.hosts: [\\\"@@{ES_Master.address}@@\\\"]\" | sudo tee datanodes.txt\nfor n in ${DATANODES[@]};do sed -i 's%]%'\",\\\"$n\\\"]\"'%' datanodes.txt ;done\ncat datanodes.txt | sudo tee -a \/etc\/elasticsearch\/elasticsearch.yml\n\n# enable service and start service\nsudo systemctl daemon-reload\nsudo systemctl enable elasticsearch.service\nsudo systemctl start elasticsearch.service","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ae20f0fb_runbook","main_task_local_reference":{"kind":"app_task","name":"e25e95bd_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"41c2e4b4_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"595046c6_runbook","main_task_local_reference":{"kind":"app_task","name":"41c2e4b4_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"22f19c87_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7c72ae09_runbook","main_task_local_reference":{"kind":"app_task","name":"22f19c87_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bfcb8e48_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e1cae220_runbook","main_task_local_reference":{"kind":"app_task","name":"bfcb8e48_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6cd94866_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0fc55da8_runbook","main_task_local_reference":{"kind":"app_task","name":"6cd94866_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"ElasticSearch_Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"data_node_ip","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"cluster_name","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure ES Data Node"}],"name":"e25e95bd_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure ES Data Node","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# variable\/macros\nVMNAME=@@{name}@@\nCLUSTER_NAME=\"@@{cluster_name}@@\"\ndeclare -a NODE_IPS\nNODE_IPS=(@@{data_node_ip}@@)\nDATANODES=$(echo ${NODE_IPS} | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n# update yml\nsudo sed -i \"s\/#node.name: node-1\/node.name: $VMNAME\/\" \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#network.host: 192.168.0.1\/network.host: 0.0.0.0\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#http.port: 9200\/http.port: 9200\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i \"s\/#cluster.name: my-application\/cluster.name: $CLUSTER_NAME\/\" \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i \"s\/#discovery.zen.minimum_master_nodes:\/discovery.zen.minimum_master_nodes: 2\/\" \/etc\/elasticsearch\/elasticsearch.yml\necho \"node.data: true\" | sudo tee -a \/etc\/elasticsearch\/elasticsearch.yml\necho \"discovery.zen.ping.unicast.hosts: [\\\"@@{ES_Master.address}@@\\\"]\" | sudo tee datanodes.txt\nfor n in ${DATANODES[@]};do sed -i 's%]%'\",\\\"$n\\\"]\"'%' datanodes.txt ;done\ncat datanodes.txt | sudo tee -a \/etc\/elasticsearch\/elasticsearch.yml\n\n# enable service and start service\nsudo systemctl daemon-reload\nsudo systemctl enable elasticsearch.service\nsudo systemctl start elasticsearch.service","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ae20f0fb_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"e25e95bd_dag_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"41c2e4b4_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"595046c6_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"41c2e4b4_dag_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"22f19c87_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7c72ae09_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"22f19c87_dag_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bfcb8e48_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e1cae220_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"bfcb8e48_dag_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6cd94866_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0fc55da8_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"6cd94866_dag_cloned_1"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"ElasticSearch_Data_Node","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"data_node_ip","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"cluster_name","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Cluster Name"}],"name":"da59a3b8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set Cluster Name","attrs":{"exit_status":[],"script":"print(\"cluster_name=nx-@@{ENV}@@-es-@@{calm_minute}@@\")","eval_variables":["cluster_name"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"4e9ced22_runbook","main_task_local_reference":{"kind":"app_task","name":"da59a3b8_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7abf6065_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7a528df8_runbook","main_task_local_reference":{"kind":"app_task","name":"7abf6065_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"ES_Master","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"psdassets-@@{ENV}@@-es-@@{calm_second}@@@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"9ca399e5-7f75-4d0a-953a-5b899d8d6ef8"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":16384,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"037d836e-483d-4350-abda-616ba055c3ac","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"C7-BASE-PSDADMIN","uuid":"5fce2f91-7738-4743-8363-aaca7bf77a27"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get Cluster Name"}],"name":"faebfd87_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Cluster Name","attrs":{"exit_status":[],"script":"print(\"cluster_name=@@{ES_Master.cluster_name}@@\")\n","eval_variables":["cluster_name"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"ac1c8464_runbook","main_task_local_reference":{"kind":"app_task","name":"faebfd87_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"ES_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1218eb2f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3934a9de_runbook","main_task_local_reference":{"kind":"app_task","name":"1218eb2f_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"ES_Data_Node","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"psdassets-@@{ENV}@@-es-@@{calm_second}@@@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"9ca399e5-7f75-4d0a-953a-5b899d8d6ef8"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":16384,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"037d836e-483d-4350-abda-616ba055c3ac","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"C7-BASE-PSDADMIN","uuid":"5fce2f91-7738-4743-8363-aaca7bf77a27"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"psdadmin","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"cred_psdadmin"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"ElasticSearch_Master"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Hostname"},{"kind":"app_task","name":"Install pre reqs"},{"kind":"app_task","name":"Volume Group"},{"kind":"app_task","name":"Install ES"},{"kind":"app_task","name":"Set Data Node IP"}],"name":"3de22848_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install pre reqs"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Volume Group"}},{"from_task_reference":{"kind":"app_task","name":"Volume Group"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install ES"}},{"from_task_reference":{"kind":"app_task","name":"Set Hostname"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install pre reqs"}},{"from_task_reference":{"kind":"app_task","name":"Install ES"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Set Data Node IP"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set Hostname","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo hostnamectl set-hostname --static @@{name}@@.churchofjesuschrist.org\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install pre reqs","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n# installing EPEL - and housekeeping for PSD Group\n# 'reset' the epel repository\nsudo rm -f \/etc\/yum.repos.d\/epel.repo\nsudo yum install -y wget\necho '[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/$basearch\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=1\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\n \n[epel-debuginfo]\nname=Extra Packages for Enterprise Linux 7 - $basearch - Debug\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/$basearch\/debug\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-debug-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\n \n[epel-source]\nname=Extra Packages for Enterprise Linux 7 - $basearch - Source\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/SRPMS\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-source-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\ngpgcheck=1' | sudo tee \/etc\/yum.repos.d\/epel.repo\n \n# setup epel-release\n\nwget https:\/\/dl.fedoraproject.org\/pub\/epel\/epel-release-latest-7.noarch.rpm\nsudo yum install epel-release-latest-7.noarch.rpm -y\n \n# install tools\\pre-reqs\nsudo yum clean all\nsudo yum install -y lvm2\n# setup Java\nsudo yum install -y java-1.8.0-openjdk-devel","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Volume Group","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo mkdir -p \/var\/lib\/elasticsearch\nsudo pvcreate \/dev\/sdb\nsudo vgcreate elasticsearch_vg \/dev\/sdb\nsleep 3\nsudo lvcreate -l 100%VG -n elasticsearch_lvm elasticsearch_vg\nsudo mkfs.xfs \/dev\/elasticsearch_vg\/elasticsearch_lvm\necho -e \"\/dev\/elasticsearch_vg\/elasticsearch_lvm \\t \/var\/lib\/elasticsearch \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install ES","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex \n \n# import the GPG Key for ES\nsudo rpm --import https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\n \n# create the yum repo file\necho '[elasticsearch-6.x]\nname=Elasticsearch repository for 6.x packages\nbaseurl=https:\/\/artifacts.elastic.co\/packages\/6.x\/yum\ngpgcheck=1\ngpgkey=https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md' | sudo tee \/etc\/yum.repos.d\/elasticsearch.repo\n \n# install ES\n \nwget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-6.5.4.rpm\nwget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-6.5.4.rpm.sha512\nsha512sum -c elasticsearch-6.5.4.rpm.sha512\nsudo rpm --install elasticsearch-6.5.4.rpm","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set Data Node IP","attrs":{"exit_status":[],"script":"print(\"data_node_ip=@@{ES_Data_Node.address}@@\")","eval_variables":["data_node_ip"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"b1fe5248_runbook","main_task_local_reference":{"kind":"app_task","name":"3de22848_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"26c58e11_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4e52f705_runbook","main_task_local_reference":{"kind":"app_task","name":"26c58e11_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"ElasticSearch_Data_Node"}],"name":"Package1_cloned_0","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1_cloned_0"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Hostname"},{"kind":"app_task","name":"Install pre reqs"},{"kind":"app_task","name":"Volume Group"},{"kind":"app_task","name":"Install ES"},{"kind":"app_task","name":"Set IP Variable"}],"name":"3de22848_dag_cloned_1","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install pre reqs"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Volume Group"}},{"from_task_reference":{"kind":"app_task","name":"Volume Group"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install ES"}},{"from_task_reference":{"kind":"app_task","name":"Set Hostname"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install pre reqs"}},{"from_task_reference":{"kind":"app_task","name":"Install ES"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Set IP Variable"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set Hostname","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo hostnamectl set-hostname --static @@{name}@@.churchofjesuschrist.org\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install pre reqs","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n# installing EPEL - and housekeeping for PSD Group\n# 'reset' the epel repository\nsudo rm -f \/etc\/yum.repos.d\/epel.repo\nsudo yum install -y wget\necho '[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/$basearch\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=1\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\n \n[epel-debuginfo]\nname=Extra Packages for Enterprise Linux 7 - $basearch - Debug\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/$basearch\/debug\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-debug-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\n \n[epel-source]\nname=Extra Packages for Enterprise Linux 7 - $basearch - Source\n#baseurl=http:\/\/download.fedoraproject.org\/pub\/epel\/7\/SRPMS\nmetalink=https:\/\/mirrors.fedoraproject.org\/metalink?repo=epel-source-7&arch=$basearch&infra=$infra&content=$contentdir\nfailovermethod=priority\nenabled=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7\ngpgcheck=1' | sudo tee \/etc\/yum.repos.d\/epel.repo\n \n# setup epel-release\n\nwget https:\/\/dl.fedoraproject.org\/pub\/epel\/epel-release-latest-7.noarch.rpm\nsudo yum install epel-release-latest-7.noarch.rpm -y\n \n# install tools\\pre-reqs\nsudo yum clean all\nsudo yum install -y lvm2\n# setup Java\nsudo yum install -y java-1.8.0-openjdk-devel","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Volume Group","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo mkdir -p \/var\/lib\/elasticsearch\nsudo pvcreate \/dev\/sdb\nsudo vgcreate elasticsearch_vg \/dev\/sdb\nsleep 3\nsudo lvcreate -l 100%VG -n elasticsearch_lvm elasticsearch_vg\nsudo mkfs.xfs \/dev\/elasticsearch_vg\/elasticsearch_lvm\necho -e \"\/dev\/elasticsearch_vg\/elasticsearch_lvm \\t \/var\/lib\/elasticsearch \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install ES","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex \n \n# import the GPG Key for ES\nsudo rpm --import https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\n \n# create the yum repo file\necho '[elasticsearch-6.x]\nname=Elasticsearch repository for 6.x packages\nbaseurl=https:\/\/artifacts.elastic.co\/packages\/6.x\/yum\ngpgcheck=1\ngpgkey=https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md' | sudo tee \/etc\/yum.repos.d\/elasticsearch.repo\n \n# install ES\n \nwget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-6.5.4.rpm\nwget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-6.5.4.rpm.sha512\nsha512sum -c elasticsearch-6.5.4.rpm.sha512\nsudo rpm --install elasticsearch-6.5.4.rpm","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ElasticSearch_Data_Node"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Set IP Variable","attrs":{"exit_status":[],"script":"print(\"data_node_ip=@@{ES_Data_Node.address}@@\")","eval_variables":["data_node_ip"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"b1fe5248_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"3de22848_dag_cloned_1"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1_cloned_0"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"26c58e11_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4e52f705_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"26c58e11_dag_cloned_1"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"5c53846f_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"ES_Master"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"f44d3534_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"7","package_local_reference_list":[{"kind":"app_package","name":"Package1_cloned_0"}],"substrate_local_reference":{"kind":"app_substrate","name":"ES_Data_Node"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"AHV","variable_list":[{"regex":{"should_validate":false,"value":"^.*$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"ENV","value":"prod","label":"Select the Environment","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":["prod","stage","test","dev"]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"cred_psdadmin"},"type":"USER"},"name":"ElasticSearch_Nutanix_02"},"api_version":"3.0","metadata":{"last_update_time":"1619717400905101","kind":"blueprint","spec_version":34,"creation_time":"1619553390949507","name":"ElasticSearch_Nutanix_02"}}