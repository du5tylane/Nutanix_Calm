{"status":{},"product_version":"2.7.1.2","spec":{"description":"","resources":{"client_attrs":{"917b54a4_deployment":{"y":253,"x":541}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Task1"},{"kind":"app_task","name":"Restart"}],"name":"bc053875_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Task1"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Task1","attrs":{"script":"# setup common variables\nuri = \"https:\/\/172.16.2.50:9440\/api\/nutanix\/v3\"\ncluster_uuid = \"0005a083-9041-3530-3198-3cecef40cb08\"\nvm_uuid = \"a0724c88-64e6-4e6d-8147-1761dde0b056\"\n\nusername = 'admin'\nusername_secret = 'Nar1z0na90!'\n\ntshirt_size = '@@{tshirt_size}@@'\nprint(tshirt_size)\n\nif tshirt_size == 'Small':\n    exit(0)\nelif tshirt_size == 'Medium':\n    vpcu = 2\n    memory = 4096\nelif tshirt_size == 'Large':\n    vpcu = 3\n    memory = 5120\n\n###################### DEFINE FUNCTIONS ######################\ndef rest_call(url, method, payload=\"\", username=username, username_secret=username_secret):\n\n    headers = {\n        'Content-type': 'application\/json',\n        'Accept': 'application\/json'\n    }\n\n    if payload:\n        resp = urlreq(\n            url,\n            verb=method,\n            params=json.dumps(payload),\n            auth=\"BASIC\",\n            user=username,\n            passwd=username_secret,\n            headers=headers,\n            verify=False\n        )\n    else:\n        resp = urlreq(\n            url,\n            verb=method,\n            auth=\"BASIC\",\n            user=username,\n            passwd=username_secret,\n            headers=headers,\n            verify=False\n        )\n\n    if resp.ok:\n        try:\n            return json.loads(resp.content)\n        except:\n            return resp.content\n    else:\n        print(\"Request failed\")\n        print(\"Headers: {}\".format(headers))\n        print(\"Payload: {}\".format(json.dumps(payload)))\n        print('Status code: {}'.format(resp.status_code))\n        print('Response: {}'.format(json.dumps(\n            json.loads(resp.content), indent=4)))\n        exit(1)\n\n######################## GET \/UPD VM SPEC ########################\nurl = \"{}\/vms\/{}\".format(\n    uri,\n    vm_uuid\n)\n\nmethod = 'GET'\nresponse = rest_call(url=url, method=method)\n\n# delete status element from json response\ndel response['status']\n\n# update spec with new vpcu and mem\nresponse['spec']['resources']['num_sockets'] = vpcu\nresponse['spec']['resources']['memory_size_mib'] = memory\n\n######################## GET VM SPEC ########################\nurl = \"{}\/vms\/{}\".format(\n    uri,\n    vm_uuid\n)\n\nmethod = 'PUT'\npayload = response\n\nresponse = rest_call(url=url, method=method, payload=payload)\nprint(response)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"d7d9ac85_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"991332b4_runbook","main_task_local_reference":{"kind":"app_task","name":"bc053875_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3cc796bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5d02b8ea_runbook","main_task_local_reference":{"kind":"app_task","name":"3cc796bb_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6065fbd2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b2f99db5_runbook","main_task_local_reference":{"kind":"app_task","name":"6065fbd2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"451ff914_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"fae7636e_runbook","main_task_local_reference":{"kind":"app_task","name":"451ff914_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"30de55b1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d7d9ac85_runbook","main_task_local_reference":{"kind":"app_task","name":"30de55b1_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Service1","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"EXISTING_VM","name":"VM1","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":true,"address":"@@{ip_address}@@","delay_secs":"60","connection_port":22},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"0.0.0.0"},"variable_list":[]}],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Creds_PrismCentral"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Service1"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"b3fd3665_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"531a19c5_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"b3fd3665_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"98afcfcf_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a5912c44_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"98afcfcf_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"917b54a4_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"VM1"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"tshirt_size","value":"Small","label":"Sizes","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":["Small","Medium","Large"]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Creds_PrismCentral"},"type":"USER"},"name":"EScript Test"},"api_version":"3.0","metadata":{"last_update_time":"1584142613745794","kind":"blueprint","spec_version":16,"creation_time":"1584138382949454","name":"EScript Test"}}