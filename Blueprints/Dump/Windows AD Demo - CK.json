{"status":{},"product_version":"2.7.1.2","spec":{"description":"This blueprint will create a new Active Directory Forest\/Domain. It includes:\n- Two Domain Controllers\n- Enterprise Root CA\n- Jump box\n\nAssumptions:\n- DHCP or Nutanix IPAM must be present.\n- Server 2016+ Datacenter Image (Tested with Core + GUI)\n\nThe blueprint will automatically configure DNS for the DCs and all domain systems. The blueprint takes ~30 minutes due to a delay when creating the first Domain Controller in a Forest.\n\nQuestions: \nchris.kingsley@nutanix.com","resources":{"client_attrs":{"None":{"y":229.3706016541,"x":118.2727355957},"dc46fd57_deployment":{"y":-122,"x":-190.5},"46dbdad5_deployment":{"y":-161.5,"x":37.3828125},"4548cc85_deployment":{"y":106.5,"x":3.3828125}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Forest or DC"}],"name":"3f27913e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Forest or DC","attrs":{"exit_status":[],"script":"$ErrorActionPreference = \"Stop\"\n\n$DomainName = \"@@{DomainName}@@\"\n$CalmArrayIndex = @@{calm_array_index}@@\n$ServerIPs = (\"@@{ActiveDirectory.address}@@\").Split(\",\")\n$SafeModeAdministratorCredential = '@@{Windows.secret}@@' | ConvertTo-SecureString -AsPlainText -Force\n$ADDomainCredential = New-Object pscredential -ArgumentList \"@@{Windows.username}@@@$DomainName\",$SafeModeAdministratorCredential\n$DomainContext = New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext('Domain', $DomainName, $ADDomainCredential.UserName, $ADDomainCredential.GetNetworkCredential().Password)\n\nif ($CalmArrayIndex -eq 0)\n{\n  # Install Forest\n  \n  $ForestParams = @{\n      DomainName = \"$DomainName\"\n      DomainMode = \"WinThreshold\"\n      Force = $true\n      ForestMode = \"WinThreshold\"\n      SafeModeAdministratorPassword = $SafeModeAdministratorCredential\n      NoRebootOnCompletion = $true\n      WarningAction = \"SilentlyContinue\"\n  }\n\n  Write-Output \"Installing AD Forest $DomainName.\"\n\n  $Forest = Install-ADDSForest @ForestParams\n\n  # Set DNS\n  Set-DnsClientServerAddress -InterfaceAlias Ethernet -ResetServerAddresses\n  Set-DnsClient -ConnectionSpecificSuffix $DomainName -InterfaceAlias Ethernet\n  Set-DnsClientServerAddress -InterfaceAlias Ethernet -Addresses @@{address}@@,$ServerIPs[1]\n  #reg add HKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters \/v \"Repl Perform Initial Synchronization\" \/t REG_DWORD \/d 0\n  \n  if (-not $Forest.Status -eq \"Success\") { exit 2 } else { Write-Output \"AD Forest installed Successfully.\"}\n  \n}\nelseif ($CalmArrayIndex -gt 0)\n{\n    # Install Domain Controller\n    \n    Set-DnsClient -ConnectionSpecificSuffix $DomainName -InterfaceAlias Ethernet\n    Set-DnsClientServerAddress -InterfaceAlias Ethernet -Addresses $ServerIPs[0],@@{address}@@\n    \n    # Wait for the first DC to come online\n    Write-Output \"Waiting for $DomainName to become accessible.\"\n    for ($i = 0; $i -le 90 ; $i++)\n    {\n        try\n        {\n            if (([System.DirectoryServices.ActiveDirectory.DomainController]::FindOne($DomainContext)).domain.ToString() -eq $DomainName) { break }\n        }\n        catch\n        {\n\t\t\t# Cleanup errors we catch\n        \t$error.clear()\n        }\n\n        Start-Sleep -Seconds 15\n    }\n\n    $DCParams = @{\n        Credential = $ADDomainCredential\n        DomainName = \"$DomainName\"\n        Force = $true\n        SafeModeAdministratorPassword = $SafeModeAdministratorCredential\n        NoRebootOnCompletion = $true\n        WarningAction = \"SilentlyContinue\"\n    }\n\n    Write-Output \"Adding new Domain Controller to $DomainName.\"\n\n    $DomainController = Install-ADDSDomainController @DCParams\n\n    if (-not $DomainController.Status -eq \"Success\") { exit 2 } else { Write-Output \"Domain Controller added to $DomainName successfully.\"}\n   \n}\n\nSet-CertificateAutoEnrollmentPolicy -EnableAll -Context Machine\n\nRestart-Computer -Force","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"d38fa788_runbook","main_task_local_reference":{"kind":"app_task","name":"3f27913e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3474e0a0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b18c8a92_runbook","main_task_local_reference":{"kind":"app_task","name":"3474e0a0_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d32c8622_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a58a90a1_runbook","main_task_local_reference":{"kind":"app_task","name":"d32c8622_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3d5f4bbf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"15bc90e0_runbook","main_task_local_reference":{"kind":"app_task","name":"3d5f4bbf_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b72b8324_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e58e4d6e_runbook","main_task_local_reference":{"kind":"app_task","name":"b72b8324_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Domain Controllers","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join Domain"}],"name":"64ec8f10_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join Domain","attrs":{"exit_status":[],"script":"$DNS = (\"@@{ActiveDirectory.address}@@\").Split(\",\")\n$DomainName = \"@@{DomainName}@@\"\n$DomainPassword = '@@{Windows.secret}@@' | ConvertTo-SecureString -AsPlainText -Force\n$DomainCredential = New-Object pscredential -ArgumentList \"@@{Windows.username}@@@$DomainName\",$DomainPassword\n\n# Set DNS\nSet-DnsClient -ConnectionSpecificSuffix $DomainName -InterfaceAlias Ethernet\nSet-DnsClientServerAddress -InterfaceAlias Ethernet -Addresses $DNS[0],$DNS[1]\n\n# Join Domain\nAdd-Computer -DomainName $DomainName -Credential $DomainCredential -ErrorAction Stop -WarningAction SilentlyContinue\nRestart-Computer -Force\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fe37fe5a_runbook","main_task_local_reference":{"kind":"app_task","name":"64ec8f10_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"07c46e6c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"290b7f4b_runbook","main_task_local_reference":{"kind":"app_task","name":"07c46e6c_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"aeab0855_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9e6fe025_runbook","main_task_local_reference":{"kind":"app_task","name":"aeab0855_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"813d6f27_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"599cc7d9_runbook","main_task_local_reference":{"kind":"app_task","name":"813d6f27_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c09925f0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"19be121c_runbook","main_task_local_reference":{"kind":"app_task","name":"c09925f0_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"Domain Controllers"}],"name":"Jump Box","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join Domain"},{"kind":"app_task","name":"Configure ADCS"}],"name":"457b5db7_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Join Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure ADCS"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join Domain","attrs":{"exit_status":[],"script":"$DNS = (\"@@{ActiveDirectory.address}@@\").Split(\",\")\n$DomainName = \"@@{DomainName}@@\"\n$DomainPassword = '@@{Windows.secret}@@' | ConvertTo-SecureString -AsPlainText -Force\n$DomainCredential = New-Object pscredential -ArgumentList \"@@{Windows.username}@@@$DomainName\",$DomainPassword\n\n# Set DNS\nSet-DnsClient -ConnectionSpecificSuffix $DomainName -InterfaceAlias Ethernet\nSet-DnsClientServerAddress -InterfaceAlias Ethernet -Addresses $DNS[0],$DNS[1]\n\n# Join Domain\nAdd-Computer -DomainName $DomainName -Credential $DomainCredential -ErrorAction Stop -WarningAction SilentlyContinue\nRestart-Computer -Force\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure ADCS","attrs":{"exit_status":[],"script":"$ErrorActionPreference = \"Stop\"\n\n$DomainName = \"@@{DomainName}@@\"\n$DomainUser = \"@@{Windows.username}@@@$DomainName\"\n$DomainPass = '@@{Windows.secret}@@' | ConvertTo-SecureString -AsPlainText -Force\n$DomainCredential = New-Object pscredential -ArgumentList $DomainUser,$DomainPass\n\n$AdcsParams = @{\n\n    CAType = \"EnterpriseRootCa\"\n    Credential = $DomainCredential\n    CryptoProviderName = \"RSA#Microsoft Software Key Storage Provider\"\n    Force = $true\n    KeyLength = 2048\n    HashAlgorithmName = \"SHA256\"\n    ValidityPeriod = \"Years\"\n    ValidityPeriodUnits = 2\n}\n\nWrite-Output \"Installing AD Certificate Authority.\"\n$AdcsInstall = Install-AdcsCertificationAuthority @AdcsParams\n\nif (-not $AdcsInstall.ErrorId -eq 0) { exit 1 } else { Write-Output \"AD Certificate Authority installed successfully.\" }\n\nWrite-Output \"Installing ADCS Online Responder.\"\n$AdcsOrInstall = Install-AdcsOnlineResponder -Force\n\nif ($AdcsOrInstall.ErrorString) { exit 2 } else { Write-Output \"ADCS Online Responder installed successfully.\" }\n\nWrite-Output \"Installing ADCS WebEnrollment.\"\n$AdcsWEInstall = Install-AdcsWebEnrollment -Force\n\nif (-not $AdcsWeInstall.ErrorId -eq 0) { exit 3 } else { Write-Output \"ADCS Web Enrollment installed successfully.\" }\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"23d2c7de_runbook","main_task_local_reference":{"kind":"app_task","name":"457b5db7_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1000a648_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"fa44d48e_runbook","main_task_local_reference":{"kind":"app_task","name":"1000a648_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"29f3cf15_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d5717247_runbook","main_task_local_reference":{"kind":"app_task","name":"29f3cf15_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c1ba03ca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d139d1d1_runbook","main_task_local_reference":{"kind":"app_task","name":"c1ba03ca_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"abc58870_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"034e854d_runbook","main_task_local_reference":{"kind":"app_task","name":"abc58870_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"Domain Controllers"}],"name":"AD Certificate Services","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"ActiveDirectory","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Windows","create_spec":{"name":"DC0@@{calm_int(calm_array_index) + 1}@@-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"a31c1ef9-a7a6-4600-92fd-f37a07f90169"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n    <settings pass=\"specialize\">\n        <component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <SkipAutoActivation>true<\/SkipAutoActivation>\n        <\/component>\n        <component name=\"Microsoft-Windows-SQMApi\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <CEIPEnabled>0<\/CEIPEnabled>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <ComputerName>@@{name}@@<\/ComputerName>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <fDenyTSConnections>false<\/fDenyTSConnections>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAuthentication>0<\/UserAuthentication>\n        <\/component>\n        <component name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <FirewallGroups>\n                <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"1\">\n                    <Group>@FirewallAPI.dll,-28752<\/Group>\n                    <Profile>all<\/Profile>\n                    <Active>true<\/Active>\n                <\/FirewallGroup>\n            <\/FirewallGroups>\n        <\/component>\n    <\/settings>\n    <settings pass=\"oobeSystem\">\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAccounts>\n                <AdministratorPassword>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/AdministratorPassword>\n            <\/UserAccounts>\n            <AutoLogon>\n                <Password>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/Password>\n                <Username>Administrator<\/Username>\n                <LogonCount>1<\/LogonCount>\n                <Enabled>true<\/Enabled>\n            <\/AutoLogon>\n            <FirstLogonCommands>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>powershell.exe -Command Enable-PSRemoting -SkipNetworkProfileCheck -Force<\/CommandLine>\n                    <Description>Enable-PSRemoting<\/Description>\n                    <Order>1<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>2<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>Set-ExecutionPolicy<\/Description>\n                    <CommandLine>powershell.exe -Command Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force<\/CommandLine>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>3<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>logoff<\/Description>\n                    <CommandLine>logoff<\/CommandLine>\n                <\/SynchronousCommand>\n            <\/FirstLogonCommands>\n            <OOBE>\n                <HideEULAPage>true<\/HideEULAPage>\n                <HideOEMRegistrationScreen>true<\/HideOEMRegistrationScreen>\n                <HideOnlineAccountScreens>true<\/HideOnlineAccountScreens>\n                <HideWirelessSetupInOOBE>true<\/HideWirelessSetupInOOBE>\n                <HideLocalAccountScreen>true<\/HideLocalAccountScreen>\n                <NetworkLocation>Work<\/NetworkLocation>\n                <ProtectYourPC>3<\/ProtectYourPC>\n                <SkipMachineOOBE>true<\/SkipMachineOOBE>\n                <SkipUserOOBE>true<\/SkipUserOOBE>\n            <\/OOBE>\n        <\/component>\n        <component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"wow64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <InputLocale>en-US<\/InputLocale>\n            <SystemLocale>en-US<\/SystemLocale>\n            <UILanguage>en-US<\/UILanguage>\n            <UILanguageFallback>en-US<\/UILanguageFallback>\n            <UserLocale>en-US<\/UserLocale>\n        <\/component>\n    <\/settings>\n    <cpi:offlineImage cpi:source=\"wim:c:\/images\/server%202016\/sources\/install.wim#Windows Server 2016 SERVERDATACENTERCORE\" xmlns:cpi=\"urn:schemas-microsoft-com:cpi\" \/>\n<\/unattend>","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Win_Svr_Image","uuid":"4bbc709e-53e5-4daf-9188-0641abc5d476"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"Jumpbox","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Windows","create_spec":{"name":"JB0@@{calm_int(calm_array_index) + 1}@@-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"a31c1ef9-a7a6-4600-92fd-f37a07f90169"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n    <settings pass=\"specialize\">\n        <component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <SkipAutoActivation>true<\/SkipAutoActivation>\n        <\/component>\n        <component name=\"Microsoft-Windows-SQMApi\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <CEIPEnabled>0<\/CEIPEnabled>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <ComputerName>@@{name}@@<\/ComputerName>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <fDenyTSConnections>false<\/fDenyTSConnections>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAuthentication>0<\/UserAuthentication>\n        <\/component>\n        <component name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <FirewallGroups>\n                <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"1\">\n                    <Group>@FirewallAPI.dll,-28752<\/Group>\n                    <Profile>all<\/Profile>\n                    <Active>true<\/Active>\n                <\/FirewallGroup>\n            <\/FirewallGroups>\n        <\/component>\n    <\/settings>\n    <settings pass=\"oobeSystem\">\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAccounts>\n                <AdministratorPassword>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/AdministratorPassword>\n            <\/UserAccounts>\n            <AutoLogon>\n                <Password>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/Password>\n                <Username>Administrator<\/Username>\n                <LogonCount>1<\/LogonCount>\n                <Enabled>true<\/Enabled>\n            <\/AutoLogon>\n            <FirstLogonCommands>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>powershell.exe -Command Enable-PSRemoting -SkipNetworkProfileCheck -Force<\/CommandLine>\n                    <Description>Enable-PSRemoting<\/Description>\n                    <Order>1<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>2<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>Set-ExecutionPolicy<\/Description>\n                    <CommandLine>powershell.exe -Command Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force<\/CommandLine>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>3<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>logoff<\/Description>\n                    <CommandLine>logoff<\/CommandLine>\n                <\/SynchronousCommand>\n            <\/FirstLogonCommands>\n            <OOBE>\n                <HideEULAPage>true<\/HideEULAPage>\n                <HideOEMRegistrationScreen>true<\/HideOEMRegistrationScreen>\n                <HideOnlineAccountScreens>true<\/HideOnlineAccountScreens>\n                <HideWirelessSetupInOOBE>true<\/HideWirelessSetupInOOBE>\n                <HideLocalAccountScreen>true<\/HideLocalAccountScreen>\n                <NetworkLocation>Work<\/NetworkLocation>\n                <ProtectYourPC>3<\/ProtectYourPC>\n                <SkipMachineOOBE>true<\/SkipMachineOOBE>\n                <SkipUserOOBE>true<\/SkipUserOOBE>\n            <\/OOBE>\n        <\/component>\n        <component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"wow64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <InputLocale>en-US<\/InputLocale>\n            <SystemLocale>en-US<\/SystemLocale>\n            <UILanguage>en-US<\/UILanguage>\n            <UILanguageFallback>en-US<\/UILanguageFallback>\n            <UserLocale>en-US<\/UserLocale>\n        <\/component>\n    <\/settings>\n    <cpi:offlineImage cpi:source=\"wim:c:\/images\/server%202016\/sources\/install.wim#Windows Server 2016 SERVERDATACENTERCORE\" xmlns:cpi=\"urn:schemas-microsoft-com:cpi\" \/>\n<\/unattend>","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Win_Svr_Image","uuid":"4bbc709e-53e5-4daf-9188-0641abc5d476"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"ADCS","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Windows","create_spec":{"name":"ADCS0@@{calm_int(calm_array_index) + 1}@@-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"a31c1ef9-a7a6-4600-92fd-f37a07f90169"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n    <settings pass=\"specialize\">\n        <component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <SkipAutoActivation>true<\/SkipAutoActivation>\n        <\/component>\n        <component name=\"Microsoft-Windows-SQMApi\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <CEIPEnabled>0<\/CEIPEnabled>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <ComputerName>@@{name}@@<\/ComputerName>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <fDenyTSConnections>false<\/fDenyTSConnections>\n        <\/component>\n        <component name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAuthentication>0<\/UserAuthentication>\n        <\/component>\n        <component name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <FirewallGroups>\n                <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"1\">\n                    <Group>@FirewallAPI.dll,-28752<\/Group>\n                    <Profile>all<\/Profile>\n                    <Active>true<\/Active>\n                <\/FirewallGroup>\n            <\/FirewallGroups>\n        <\/component>\n    <\/settings>\n    <settings pass=\"oobeSystem\">\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAccounts>\n                <AdministratorPassword>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/AdministratorPassword>\n            <\/UserAccounts>\n            <AutoLogon>\n                <Password>\n                    <Value>@@{Windows.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/Password>\n                <Username>Administrator<\/Username>\n                <LogonCount>1<\/LogonCount>\n                <Enabled>true<\/Enabled>\n            <\/AutoLogon>\n            <FirstLogonCommands>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>powershell.exe -Command Enable-PSRemoting -SkipNetworkProfileCheck -Force<\/CommandLine>\n                    <Description>Enable-PSRemoting<\/Description>\n                    <Order>1<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>2<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>Set-ExecutionPolicy<\/Description>\n                    <CommandLine>powershell.exe -Command Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force<\/CommandLine>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>3<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>logoff<\/Description>\n                    <CommandLine>logoff<\/CommandLine>\n                <\/SynchronousCommand>\n            <\/FirstLogonCommands>\n            <OOBE>\n                <HideEULAPage>true<\/HideEULAPage>\n                <HideOEMRegistrationScreen>true<\/HideOEMRegistrationScreen>\n                <HideOnlineAccountScreens>true<\/HideOnlineAccountScreens>\n                <HideWirelessSetupInOOBE>true<\/HideWirelessSetupInOOBE>\n                <HideLocalAccountScreen>true<\/HideLocalAccountScreen>\n                <NetworkLocation>Work<\/NetworkLocation>\n                <ProtectYourPC>3<\/ProtectYourPC>\n                <SkipMachineOOBE>true<\/SkipMachineOOBE>\n                <SkipUserOOBE>true<\/SkipUserOOBE>\n            <\/OOBE>\n        <\/component>\n        <component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"wow64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <InputLocale>en-US<\/InputLocale>\n            <SystemLocale>en-US<\/SystemLocale>\n            <UILanguage>en-US<\/UILanguage>\n            <UILanguageFallback>en-US<\/UILanguageFallback>\n            <UserLocale>en-US<\/UserLocale>\n        <\/component>\n    <\/settings>\n    <cpi:offlineImage cpi:source=\"wim:c:\/images\/server%202016\/sources\/install.wim#Windows Server 2016 SERVERDATACENTERCORE\" xmlns:cpi=\"urn:schemas-microsoft-com:cpi\" \/>\n<\/unattend>","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Win_Svr_Image","uuid":"4bbc709e-53e5-4daf-9188-0641abc5d476"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"Administrator","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Windows"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Domain Controllers"}],"name":"AddWindowsFeature","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AddWindowsFeature"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install ADDS"}],"name":"dde3ed84_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Domain Controllers"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install ADDS","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Add the feature\nInstall-WindowsFeature AD-Domain-Services -IncludeAllSubFeature -IncludeManagementTools","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4352dd6a_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"dde3ed84_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AddWindowsFeature"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"dcd113eb_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"85d73b88_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"dcd113eb_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jump Box"}],"name":"Install RSAT","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Install RSAT"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install RSAT"}],"name":"331b457b_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jump Box"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install RSAT","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Add all the RSAT tools to jumpbox\nGet-WindowsFeature RSAT* | Install-WindowsFeature","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1b5a7360_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"331b457b_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Install RSAT"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"ef264274_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8a622086_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ef264274_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"AD Certificate Services"}],"name":"Install ADCS","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Install ADCS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install ADCS"}],"name":"e6c1a193_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"AD Certificate Services"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install ADCS","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install ADCS\nInstall-WindowsFeature ADCS-Cert-Authority, ADCS-Online-Cert, ADCS-Web-Enrollment -IncludeAllSubFeature -IncludeManagementTools","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Windows"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"b588f61e_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e6c1a193_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Install ADCS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"71274da9_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e7761e85_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"71274da9_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"dc46fd57_deployment","published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"AddWindowsFeature"}],"substrate_local_reference":{"kind":"app_substrate","name":"ActiveDirectory"},"min_replicas":"2","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"46dbdad5_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Install RSAT"}],"substrate_local_reference":{"kind":"app_substrate","name":"Jumpbox"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"4548cc85_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Install ADCS"}],"substrate_local_reference":{"kind":"app_substrate","name":"ADCS"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DomainName","value":"domain.local","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Windows"},"type":"USER"},"name":"Windows AD Demo - CK"},"api_version":"3.0","metadata":{"last_update_time":"1591795684174824","kind":"blueprint","spec_version":1,"creation_time":"1591711413949949","name":"Windows AD Demo - CK"}}