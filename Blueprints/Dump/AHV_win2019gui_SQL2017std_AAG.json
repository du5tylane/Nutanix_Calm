{"status":{},"product_version":"2.7.1.2","spec":{"description":"","resources":{"client_attrs":{"47d9b2fc-4694-ad80-a2fe-d0281f3a789f":{"y":85.7922077922,"x":845.5389610389},"dd1c9949_deployment":{"y":42.7922077922,"x":525.5389610389},"None":{"y":421,"x":589.5},"965b427d-89fd-42e9-aab3-215b355d0c07":{"y":421,"x":589.5},"c6232c93-61b7-42c3-9a67-062abd32727b":{"y":421,"x":589.5},"99a33f70-dc74-ef66-0c6b-8bdd0640cf46":{"y":70.4896123713,"x":428.3110151811},"a251ef4b-0581-0a6b-1379-7a94a0fab60d":{"y":178.4285714286,"x":909.3571428571},"51367dbb_deployment":{"y":40.7922077922,"x":808.5389610389},"f38cb4df-23b5-444d-bb74-c7d9873ca03d":{"y":186.4285714286,"x":653.3571428571}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5099ee22_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f666cee9_runbook","main_task_local_reference":{"kind":"app_task","name":"5099ee22_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c0af5652_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6337c938_runbook","main_task_local_reference":{"kind":"app_task","name":"c0af5652_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ebb22e9c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"53e016c4_runbook","main_task_local_reference":{"kind":"app_task","name":"ebb22e9c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a375fe77_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"252d8b28_runbook","main_task_local_reference":{"kind":"app_task","name":"a375fe77_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c71c893a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"efb65c85_runbook","main_task_local_reference":{"kind":"app_task","name":"c71c893a_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Node1","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5099ee22_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f666cee9_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"5099ee22_dag_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c0af5652_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6337c938_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"c0af5652_dag_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ebb22e9c_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"53e016c4_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"ebb22e9c_dag_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a375fe77_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"252d8b28_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"a375fe77_dag_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c71c893a_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"efb65c85_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"c71c893a_dag_cloned_1"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"Node1"}],"name":"Node2","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"AHV_Node1","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Windows","create_spec":{"name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"89c4632d-c481-48e1-ba35-bb920855c717"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n  <settings pass=\"specialize\">\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <ComputerName>@@{calm_application_name}@@<\/ComputerName>\n        <RegisteredOrganization><\/RegisteredOrganization>\n        <RegisteredOwner><\/RegisteredOwner>\n        <TimeZone>UTC<\/TimeZone>\n     <\/component>\n     <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n        <fDenyTSConnections>false<\/fDenyTSConnections>\n     <\/component>\n     <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n        <UserAuthentication>0<\/UserAuthentication>\n     <\/component>\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <FirewallGroups>\n           <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n              <Active>true<\/Active>\n              <Profile>all<\/Profile>\n              <Group>@FirewallAPI.dll,-28752<\/Group>\n           <\/FirewallGroup>\n        <\/FirewallGroups>\n     <\/component>\n  <\/settings>\n  <settings pass=\"oobeSystem\">\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <UserAccounts>\n           <AdministratorPassword>\n              <Value>@@{Creds_WINDOWS.secret}@@<\/Value>\n              <PlainText>true<\/PlainText>\n           <\/AdministratorPassword>\n        <\/UserAccounts>\n        <AutoLogon>\n           <Password>\n              <Value>@@{Creds_WINDOWS.secret}@@<\/Value>\n              <PlainText>true<\/PlainText>\n           <\/Password>\n           <Enabled>true<\/Enabled>\n           <Username>Administrator<\/Username>\n        <\/AutoLogon>\n\t\t<FirstLogonCommands>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>cmd.exe \/c netsh advfirewall firewall add rule name=\"Port 5985\" dir=in action=allow protocol=TCP localport=5985<\/CommandLine>\n              <Description>Win RM port open<\/Description>\n              <Order>1<\/Order>\n              <RequiresUserInput>true<\/RequiresUserInput>\n           <\/SynchronousCommand>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>powershell -Command \"Enable-PSRemoting -SkipNetworkProfileCheck -Force\"<\/CommandLine>\n              <Description>Enable PS-Remoting<\/Description>\n              <Order>2<\/Order>\n              <RequiresUserInput>true<\/RequiresUserInput>\n           <\/SynchronousCommand>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>powershell -Command \"Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\"<\/CommandLine>\n              <Description>Enable Remote-Signing<\/Description>\n              <Order>3<\/Order>\n              <RequiresUserInput>false<\/RequiresUserInput>\n            <\/SynchronousCommand>\n            <SynchronousCommand wcm:action=\"add\">\n               <Order>4<\/Order>\n               <CommandLine>REG ADD HKLM\\System\\CurrentControlSet\\Control\\Network\\NewNetworkWindowOff \/F<\/CommandLine>\n               <Description>No New Network Block<\/Description>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n        <\/FirstLogonCommands>\n        <OOBE>\n           <HideEULAPage>true<\/HideEULAPage>\n           <SkipMachineOOBE>true<\/SkipMachineOOBE>\n        <\/OOBE>\n     <\/component>\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <InputLocale>en-US<\/InputLocale>\n        <SystemLocale>en-US<\/SystemLocale>\n        <UILanguageFallback>en-us<\/UILanguageFallback>\n        <UILanguage>en-US<\/UILanguage>\n           <UserLocale>en-US<\/UserLocale>\n     <\/component>\n  <\/settings>\n<\/unattend>\n\n\n\n","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Win2019gui-SQL-C_Drive","uuid":"79275460-b189-4dca-a422-5eecc345ca16"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"Win2019gui-SQL-D_Drive","uuid":"38628108-7728-4a11-b7a1-3b8f1e6c41d5"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"SQL2017Std","uuid":"add1c915-7575-4230-97a7-b192d68020a4"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"},"device_type":"CDROM"}},{"data_source_reference":null,"type":"","disk_size_mib":40960,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":5120,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":6144,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"AHV_Node2","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Windows","create_spec":{"name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"89c4632d-c481-48e1-ba35-bb920855c717"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n  <settings pass=\"specialize\">\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <ComputerName>@@{calm_application_name}@@<\/ComputerName>\n        <RegisteredOrganization><\/RegisteredOrganization>\n        <RegisteredOwner><\/RegisteredOwner>\n        <TimeZone>UTC<\/TimeZone>\n     <\/component>\n     <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n        <fDenyTSConnections>false<\/fDenyTSConnections>\n     <\/component>\n     <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n        <UserAuthentication>0<\/UserAuthentication>\n     <\/component>\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <FirewallGroups>\n           <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n              <Active>true<\/Active>\n              <Profile>all<\/Profile>\n              <Group>@FirewallAPI.dll,-28752<\/Group>\n           <\/FirewallGroup>\n        <\/FirewallGroups>\n     <\/component>\n  <\/settings>\n  <settings pass=\"oobeSystem\">\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <UserAccounts>\n           <AdministratorPassword>\n              <Value>@@{Creds_WINDOWS.secret}@@<\/Value>\n              <PlainText>true<\/PlainText>\n           <\/AdministratorPassword>\n        <\/UserAccounts>\n        <AutoLogon>\n           <Password>\n              <Value>@@{Creds_WINDOWS.secret}@@<\/Value>\n              <PlainText>true<\/PlainText>\n           <\/Password>\n           <Enabled>true<\/Enabled>\n           <Username>Administrator<\/Username>\n        <\/AutoLogon>\n\t\t<FirstLogonCommands>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>cmd.exe \/c netsh advfirewall firewall add rule name=\"Port 5985\" dir=in action=allow protocol=TCP localport=5985<\/CommandLine>\n              <Description>Win RM port open<\/Description>\n              <Order>1<\/Order>\n              <RequiresUserInput>true<\/RequiresUserInput>\n           <\/SynchronousCommand>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>powershell -Command \"Enable-PSRemoting -SkipNetworkProfileCheck -Force\"<\/CommandLine>\n              <Description>Enable PS-Remoting<\/Description>\n              <Order>2<\/Order>\n              <RequiresUserInput>true<\/RequiresUserInput>\n           <\/SynchronousCommand>\n           <SynchronousCommand wcm:action=\"add\">\n              <CommandLine>powershell -Command \"Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\"<\/CommandLine>\n              <Description>Enable Remote-Signing<\/Description>\n              <Order>3<\/Order>\n              <RequiresUserInput>false<\/RequiresUserInput>\n            <\/SynchronousCommand>\n            <SynchronousCommand wcm:action=\"add\">\n               <Order>4<\/Order>\n               <CommandLine>REG ADD HKLM\\System\\CurrentControlSet\\Control\\Network\\NewNetworkWindowOff \/F<\/CommandLine>\n               <Description>No New Network Block<\/Description>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n        <\/FirstLogonCommands>\n        <OOBE>\n           <HideEULAPage>true<\/HideEULAPage>\n           <SkipMachineOOBE>true<\/SkipMachineOOBE>\n        <\/OOBE>\n     <\/component>\n     <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n        <InputLocale>en-US<\/InputLocale>\n        <SystemLocale>en-US<\/SystemLocale>\n        <UILanguageFallback>en-us<\/UILanguageFallback>\n        <UILanguage>en-US<\/UILanguage>\n           <UserLocale>en-US<\/UserLocale>\n     <\/component>\n  <\/settings>\n<\/unattend>\n\n\n\n","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Win2019gui-SQL-C_Drive","uuid":"79275460-b189-4dca-a422-5eecc345ca16"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"Win2019gui-SQL-D_Drive","uuid":"38628108-7728-4a11-b7a1-3b8f1e6c41d5"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"SQL2017Std","uuid":"add1c915-7575-4230-97a7-b192d68020a4"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"},"device_type":"CDROM"}},{"data_source_reference":null,"type":"","disk_size_mib":40960,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":5120,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":6144,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Creds_PrismCentral"},{"username":"administrator","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Creds_WINDOWS"},{"username":"administrator@dustylane.local","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Creds_DomainAdmin"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Node1"}],"name":"Node1_Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Node1_Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Execution Policy"},{"kind":"app_task","name":"CDROM Letter"},{"kind":"app_task","name":"Resize Partitions"},{"kind":"app_task","name":"WSFC Features"},{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"sleep"},{"kind":"app_task","name":"SQL Volume Labels"},{"kind":"app_task","name":"Install SQL"},{"kind":"app_task","name":"SQL Firewall Rules"},{"kind":"app_task","name":"Eject CDROM"}],"name":"ba5eb2b6_dag_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Execution Policy"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"CDROM Letter"}},{"from_task_reference":{"kind":"app_task","name":"CDROM Letter"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Resize Partitions"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SQL Firewall Rules"}},{"from_task_reference":{"kind":"app_task","name":"SQL Firewall Rules"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Eject CDROM"}},{"from_task_reference":{"kind":"app_task","name":"sleep"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SQL Volume Labels"}},{"from_task_reference":{"kind":"app_task","name":"Resize Partitions"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WSFC Features"}},{"from_task_reference":{"kind":"app_task","name":"WSFC Features"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}},{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"sleep"}},{"from_task_reference":{"kind":"app_task","name":"SQL Volume Labels"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install SQL"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Set Execution Policy","state":"ACTIVE","attrs":{"exit_status":[],"script":"Set-ExecutionPolicy -ExecutionPolicy unrestricted -Confirm:$false","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"CDROM Letter","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to change the CDROM drive letter\n    .DESCRIPTION\n        This script leverages the WMI command (if there are multiple CDs),\n        selects the first object in the array and then assigns a \n        specific letter to that device.\n    .NOTES\n        Version:        1.0\n        Author:         Dusty Lane\n        Creation Date:  03\/20\/2020\n        Purpose\/Change: Initial script development\n  \n#>\n# change drive letter of CD\nWrite-Host \"Changing drive letter for cdrom\" -ForegroundColor Green\nGet-WmiObject -Class Win32_volume -Filter 'DriveType=5' | Select-Object -First 1 | Set-WmiInstance -Arguments @{DriveLetter='B:'}\nGet-WmiObject -Class Win32_volume -Filter 'DriveType=5' | Select-Object -Last 1 | Set-WmiInstance -Arguments @{DriveLetter='A:'}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Resize Partitions","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Finds raw volumes, creates partitions.  Finds free space and allocates it to partitions.\n    .DESCRIPTION\n        This script is designed to find any offline disks, bring them\n        online, initialize\\format the partitions and assign the next available\n        drive letter.\n\n        For free space found on an existing disk, it will grow the partition\n        utilizing all available free space.\n\n    .NOTES\n        Version:        1.0.1\n        Author:         Dusty Lane\n        Creation Date:  06\/08\/2020\n        Purpose\/Change: add some error handling and change logic.\n  \n#>\n\ntry {\n    # Get the disks\n\n    $Disks = Get-Disk\n\n    foreach ($Disk in $Disks) \n    {\n        # My thought process is to \n        # Bring all the drives online if they are offline....\n\n        # Let filter through any drive that might be offline.\n        if ($disk.operationalstatus -eq \"Offline\")\n        {\n            $disk | set-disk -isoffline $false \n            $disk | set-disk -isReadOnly $false\n        }\n        \n        # I want to make sure that all 'raw' drives are formatted \n        # But we need to add drive letters in order....  going to \n        # convert letter to numbers and add 1, then convert back to letters.\n        #\n        # format any volumes that are 'raw'\n        if ($disk.partitionstyle -eq 'RAW')\n        {\n            Initialize-Disk -Number $disk.DiskNumber -PartitionStyle GPT -PassThru -ErrorAction SilentlyContinue\n            \n            # need to get the drive letter that would be next in line....\n            $findletter = ((get-volume | where-object {$_.driveletter -match '.'}).driveletter | Sort-Object)[-1]\n            $letter = [byte]$findletter + 1\n            $letter = [char]$letter\n            New-Partition -DiskNumber $disk.DiskNumber -DriveLetter $letter -UseMaximumSize\n            Format-Volume -DriveLetter $letter -FileSystem NTFS -NewFileSystemLabel \"$($letter)_Drive\" -AllocationUnitSize 64kb -Confirm:$false\n        }\n    }\n\n    # Get volumes\n    $Volumes = get-volume | where-object {$_.driveletter -match '.'} | where-object {$_.DriveType -eq 'Fixed'}\n\n    # Get partitions on each volume\n    foreach ($Volume in $Volumes)\n    {\n        # The intent here is to see if any of the drives have had space added them.\n        # I think that to do this, we need to check the partition and compare to the volume.\n        # we need to get some variables to make this happen\n        $Partition = Get-Partition -DriveLetter $Volume.DriveLetter\n        $disk = Get-Disk | Where-Object {$_.path -eq $partition.diskid}\n        # get the maximum the size the partition can be.\n        $size = (Get-PartitionSupportedSize -DiskNumber $disk.number -PartitionNumber $Partition.PartitionNumber)\n        if (($Size.SizeMax - $volume.Size) -gt 102400000)\n        {\n            Write-output \"Resizing volume $($Volume.DriveLetter)\"\n            Resize-Partition -DiskNumber $disk.number -PartitionNumber $Partition.PartitionNumber -Size $size.SizeMax -confirm:$false -whatif\n        }\n    }    \n}\ncatch {\n    $error[0]\n}\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"WSFC Features","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to install prerequisites for SQL AAG\n    .DESCRIPTION\n        This is the first script in a series of scripts\n        that is intended for use in an automation sequence to \n        confiugre SQL Always On\n    .NOTES\n        Version:        1.0\n        Author:         Dusty Lane\n        Creation Date:  04\/02\/2020\n        Purpose\/Change: Initial script development\n  \n#>\n#\n# install pre-requirements for SQL always on\nAdd-WindowsFeature NET-FRAMEWORK-45-CORE,failover-clustering,rsat-clustering-powershell,rsat-clustering-cmdinterface","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Join AD Domain","state":"ACTIVE","attrs":{"exit_status":[],"script":"\n# set the execution policy on the server (atleast temporarily)\nSet-ExecutionPolicy -ExecutionPolicy Unrestricted\n\n# \n# get the index number of the interface\n$InterfaceIndex = (Get-NetIPInterface -AddressFamily ipv4 | \n    where-object {$_.connectionstate -eq \"Connected\"} | \n    where-object {$_.interfacealias -notlike \"Loopback*\"} | \n    Select-Object -First 1).ifIndex\n\n# establish a variable for the IP of the domain controller\n\n$DNSIP = \"@@{DNSServer_IP}@@\" \n\n# set the DNS server so that we can resolve the domain name\nSet-DnsClientServerAddress -InterfaceIndex $InterfaceIndex -ServerAddresses ($DNSIP)\n\n# join computer to domain\n$domainname = ((\"@@{FQDN_Domain}@@\").split('.'))[0]\n$domainAdmin = \"@@{Creds_DomainAdmin.username}@@\" \n$domainPass = ConvertTo-SecureString -asPlainText -Force -String \"@@{Creds_DomainAdmin.secret}@@\"\n\n$DACredential = New-Object System.Management.Automation.PSCredential(\"$($domainName)\\$($domainAdmin)\",$domainPass)\n\nAdd-Computer -DomainName $domainname -Credential $DACredential -Restart -Force -Verbose","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"sleep","state":"ACTIVE","attrs":{"script":"#script\nsleep(30)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"SQL Volume Labels","state":"ACTIVE","attrs":{"exit_status":[],"script":"# SQL Lettering\n\nGet-volume -DriveLetter E | Set-Volume -NewFileSystemLabel \"SQLUserDB\"\nGet-volume -DriveLetter F | Set-Volume -NewFileSystemLabel \"SQLTempDB\"\nGet-volume -DriveLetter G | Set-Volume -NewFileSystemLabel \"SQLUserLogs\"\nGet-volume -DriveLetter H | Set-Volume -NewFileSystemLabel \"SQLTempLogs\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install SQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"##################################\n##  SQL Install                 ##\n##################################\n\n# ref:  https:\/\/docs.microsoft.com\/en-us\/sql\/database-engine\/install-windows\/install-sql-server-using-sysprep?view=sql-server-ver15\n\n\n#Region Parameters\n\n#For production use, this should be parameterized or encrypted\n$SAPWD = \"@@{SAPWD}@@\"\n\n$SQLUSERDBDIR=\"E:\\MSSQL\\Data\"\n$SQLUSERDBLOGDIR=\"G:\\MSSQL\\Data\"\n$SQLTEMPDBDIR=\"F:\\MSSQL\\Data\"\n$SQLTEMPDBLOGDIR=\"H:\\MSSQL\\Data\"\n$INSTANCEDIR=\"d:\\Program Files\\Microsoft SQL Server\"\n$INSTALLSHAREDDIR=\"d:\\Program Files\\Microsoft SQL Server\"\n$INSTALLSHAREDWOWDIR=\"d:\\Program Files (x86)\\Microsoft SQL Server\"\n#EndRegion\n\n\n$configuration = @\"\n;SQL Server 2017 Configuration File\n[OPTIONS]\nIACCEPTPYTHONLICENSETERMS=\"False\"\nIACCEPTSQLSERVERLICENSETERMS=\"True\"\nACTION=\"CompleteImage\"\nSUPPRESSPRIVACYSTATEMENTNOTICE=\"True\"\nIACCEPTROPENLICENSETERMS=\"True\"\nENU=\"True\"\nQUIET=\"False\"\nQUIETSIMPLE=\"False\"\n;UIMODE=\"Normal\"\nUSEMICROSOFTUPDATE=\"True\"\nHELP=\"False\"\nINDICATEPROGRESS=\"False\"\nX86=\"False\"\nINSTANCENAME=\"MSSQLSERVER\"\nINSTANCEID=\"MSSQLSERVER\"\nSQLTELSVCACCT=\"NT Service\\SQLTELEMETRY\"\nSQLTELSVCSTARTUPTYPE=\"Automatic\"\nAGTSVCACCOUNT=\"NT Service\\SQLSERVERAGENT\"\nAGTSVCSTARTUPTYPE=\"Manual\"\nSQLSVCSTARTUPTYPE=\"Automatic\"\nFILESTREAMLEVEL=\"0\"\nENABLERANU=\"False\"\nSQLCOLLATION=\"SQL_Latin1_General_CP1_CI_AS\"\nSQLSVCACCOUNT=\"NT Service\\MSSQLSERVER\"\nSQLSVCINSTANTFILEINIT=\"False\"\nSQLSYSADMINACCOUNTS=\"BUILTIN\\Administrators\"\nSECURITYMODE=\"SQL\"\nSQLTEMPDBFILECOUNT=\"2\"\nSQLTEMPDBFILESIZE=\"8\"\nSQLTEMPDBFILEGROWTH=\"64\"\nSQLTEMPDBLOGFILESIZE=\"8\"\nSQLTEMPDBLOGFILEGROWTH=\"64\"\nINSTALLSQLDATADIR=\"D:\\Program Files\\Microsoft SQL Server\"\nSQLUSERDBDIR=$SQLUSERDBDIR\nSQLUSERDBLOGDIR=$SQLUSERDBLOGDIR\nSQLTEMPDBDIR=$SQLTEMPDBDIR\nSQLTEMPDBLOGDIR=$SQLTEMPDBLOGDIR\nADDCURRENTUSERASSQLADMIN=\"False\"\nTCPENABLED=\"0\"\nNPENABLED=\"0\"\nBROWSERSVCSTARTUPTYPE=\"Disabled\"\nFTSVCACCOUNT=\"NT Service\\MSSQLFDLauncher\"\n\"@\n\n$configuration | Out-File -FilePath c:\\SQLSysprep\\SQL_ConfigurationFile.INI -Encoding ascii -Force\n\n# Complete the sql install after the server has been sysprep'd\n#Invoke-Command {\n#    B:\\Setup.exe \/q \/SAPWD=$SAPWD \/ConfigurationFile=\"c:\\SQLSysprep\\SQL_ConfigurationFile.INI\"\n#}\n$Arguments = \"\/q \/SAPWD=$SAPWD \/ConfigurationFile=c:\\SQLSysprep\\SQL_ConfigurationFile.INI\"\n\nStart-Process -FilePath \"B:\\Setup.exe\" -ArgumentList $Arguments -Wait -Verb RunAs\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"SQL Firewall Rules","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to install prerequisites for SQL AAG\n    .DESCRIPTION\n        This is one of the scripts in a series of scripts\n        that is intended for use in an automation sequence to \n        confiugre SQL Always On.\n\n        This script specifically sets the firewall rules\n\n    .NOTES\n        Version:        1.1\n        Author:         Dusty Lane\n        Creation Date:  06\/09\/2020\n        Purpose\/Change: add AAG port\n  \n#>\n\nNew-NetFirewallRule -DisplayName \"SQL Server - TCP 1433\" -Direction Inbound -Protocol TCP -LocalPort 1433 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Admin Connection - TCP 1434\" -Direction Inbound -Protocol TCP -LocalPort 1434 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Database Management - UDP 1434\" -Direction Inbound -Protocol UDP -LocalPort 1434 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Service Broker - TCP 4022\" -Direction Inbound -Protocol TCP -LocalPort 4022 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Debugger-RPC - TCP 135\" -Direction Inbound -Protocol TCP -LocalPort 135 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Browser - TCP 2382\" -Direction Inbound -Protocol TCP -LocalPort 2382 -Action allow\n# this next rule may need to be updated if the port is changed\nNew-NetFirewallRule -DisplayName \"SQL AAG - TCP 5022\" -Direction Inbound -Protocol TCP -LocalPort 5022 -Action allow","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Eject CDROM","state":"ACTIVE","attrs":{"exit_status":[],"script":"try { \n$CDROM = New-Object -ComObject \"Shell.Application\"\n$CDROM.Namespace(17).Items() | \n    Where-Object { $_.Type -eq \"CD Drive\" } | \n        foreach { $_.InvokeVerb(\"Eject\") }\n\n} catch { \n    $_\n} ","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"cae79b83_runbook_cloned_0","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ba5eb2b6_dag_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Node1_Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"1ae97f3d_dag_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"01c721d0_runbook_cloned_0","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"1ae97f3d_dag_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Node2"}],"name":"Node2_Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Node2_Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Execution Policy"},{"kind":"app_task","name":"CDROM Letter"},{"kind":"app_task","name":"Resize Partitions"},{"kind":"app_task","name":"WSFC Features"},{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"sleep"},{"kind":"app_task","name":"SQL Volume Labels"},{"kind":"app_task","name":"Install SQL"},{"kind":"app_task","name":"SQL Firewall Rules"},{"kind":"app_task","name":"Eject CDROM"}],"name":"ba5eb2b6_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Execution Policy"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"CDROM Letter"}},{"from_task_reference":{"kind":"app_task","name":"CDROM Letter"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Resize Partitions"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SQL Firewall Rules"}},{"from_task_reference":{"kind":"app_task","name":"SQL Firewall Rules"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Eject CDROM"}},{"from_task_reference":{"kind":"app_task","name":"sleep"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SQL Volume Labels"}},{"from_task_reference":{"kind":"app_task","name":"Resize Partitions"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WSFC Features"}},{"from_task_reference":{"kind":"app_task","name":"WSFC Features"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}},{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"sleep"}},{"from_task_reference":{"kind":"app_task","name":"SQL Volume Labels"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install SQL"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Set Execution Policy","state":"ACTIVE","attrs":{"exit_status":[],"script":"Set-ExecutionPolicy -ExecutionPolicy unrestricted -Confirm:$false","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"CDROM Letter","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to change the CDROM drive letter\n    .DESCRIPTION\n        This script leverages the WMI command (if there are multiple CDs),\n        selects the first object in the array and then assigns a \n        specific letter to that device.\n    .NOTES\n        Version:        1.0\n        Author:         Dusty Lane\n        Creation Date:  03\/20\/2020\n        Purpose\/Change: Initial script development\n  \n#>\n# change drive letter of CD\nWrite-Host \"Changing drive letter for cdrom\" -ForegroundColor Green\nGet-WmiObject -Class Win32_volume -Filter 'DriveType=5' | Select-Object -First 1 | Set-WmiInstance -Arguments @{DriveLetter='B:'}\nGet-WmiObject -Class Win32_volume -Filter 'DriveType=5' | Select-Object -Last 1 | Set-WmiInstance -Arguments @{DriveLetter='A:'}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Resize Partitions","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Finds raw volumes, creates partitions.  Finds free space and allocates it to partitions.\n    .DESCRIPTION\n        This script is designed to find any offline disks, bring them\n        online, initialize\\format the partitions and assign the next available\n        drive letter.\n\n        For free space found on an existing disk, it will grow the partition\n        utilizing all available free space.\n\n    .NOTES\n        Version:        1.0.1\n        Author:         Dusty Lane\n        Creation Date:  06\/08\/2020\n        Purpose\/Change: add some error handling and change logic.\n  \n#>\n\ntry {\n    # Get the disks\n\n    $Disks = Get-Disk\n\n    foreach ($Disk in $Disks) \n    {\n        # My thought process is to \n        # Bring all the drives online if they are offline....\n\n        # Let filter through any drive that might be offline.\n        if ($disk.operationalstatus -eq \"Offline\")\n        {\n            $disk | set-disk -isoffline $false \n            $disk | set-disk -isReadOnly $false\n        }\n        \n        # I want to make sure that all 'raw' drives are formatted \n        # But we need to add drive letters in order....  going to \n        # convert letter to numbers and add 1, then convert back to letters.\n        #\n        # format any volumes that are 'raw'\n        if ($disk.partitionstyle -eq 'RAW')\n        {\n            Initialize-Disk -Number $disk.DiskNumber -PartitionStyle GPT -PassThru -ErrorAction SilentlyContinue\n            \n            # need to get the drive letter that would be next in line....\n            $findletter = ((get-volume | where-object {$_.driveletter -match '.'}).driveletter | Sort-Object)[-1]\n            $letter = [byte]$findletter + 1\n            $letter = [char]$letter\n            New-Partition -DiskNumber $disk.DiskNumber -DriveLetter $letter -UseMaximumSize\n            Format-Volume -DriveLetter $letter -FileSystem NTFS -NewFileSystemLabel \"$($letter)_Drive\" -AllocationUnitSize 64kb -Confirm:$false\n        }\n    }\n\n    # Get volumes\n    $Volumes = get-volume | where-object {$_.driveletter -match '.'} | where-object {$_.DriveType -eq 'Fixed'}\n\n    # Get partitions on each volume\n    foreach ($Volume in $Volumes)\n    {\n        # The intent here is to see if any of the drives have had space added them.\n        # I think that to do this, we need to check the partition and compare to the volume.\n        # we need to get some variables to make this happen\n        $Partition = Get-Partition -DriveLetter $Volume.DriveLetter\n        $disk = Get-Disk | Where-Object {$_.path -eq $partition.diskid}\n        # get the maximum the size the partition can be.\n        $size = (Get-PartitionSupportedSize -DiskNumber $disk.number -PartitionNumber $Partition.PartitionNumber)\n        if (($Size.SizeMax - $volume.Size) -gt 102400000)\n        {\n            Write-output \"Resizing volume $($Volume.DriveLetter)\"\n            Resize-Partition -DiskNumber $disk.number -PartitionNumber $Partition.PartitionNumber -Size $size.SizeMax -confirm:$false -whatif\n        }\n    }    \n}\ncatch {\n    $error[0]\n}\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"WSFC Features","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to install prerequisites for SQL AAG\n    .DESCRIPTION\n        This is the first script in a series of scripts\n        that is intended for use in an automation sequence to \n        confiugre SQL Always On\n    .NOTES\n        Version:        1.0\n        Author:         Dusty Lane\n        Creation Date:  04\/02\/2020\n        Purpose\/Change: Initial script development\n  \n#>\n#\n# install pre-requirements for SQL always on\nAdd-WindowsFeature NET-FRAMEWORK-45-CORE,failover-clustering,rsat-clustering-powershell,rsat-clustering-cmdinterface","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Join AD Domain","state":"ACTIVE","attrs":{"exit_status":[],"script":"\n# set the execution policy on the server (atleast temporarily)\nSet-ExecutionPolicy -ExecutionPolicy Unrestricted\n\n# \n# get the index number of the interface\n$InterfaceIndex = (Get-NetIPInterface -AddressFamily ipv4 | \n    where-object {$_.connectionstate -eq \"Connected\"} | \n    where-object {$_.interfacealias -notlike \"Loopback*\"} | \n    Select-Object -First 1).ifIndex\n\n# establish a variable for the IP of the domain controller\n\n$DNSIP = \"@@{DNSServer_IP}@@\" \n\n# set the DNS server so that we can resolve the domain name\nSet-DnsClientServerAddress -InterfaceIndex $InterfaceIndex -ServerAddresses ($DNSIP)\n\n# join computer to domain\n$domainname = ((\"@@{FQDN_Domain}@@\").split('.'))[0]\n$domainAdmin = \"@@{Creds_DomainAdmin.username}@@\" \n$domainPass = ConvertTo-SecureString -asPlainText -Force -String \"@@{Creds_DomainAdmin.secret}@@\"\n\n$DACredential = New-Object System.Management.Automation.PSCredential(\"$($domainName)\\$($domainAdmin)\",$domainPass)\n\nAdd-Computer -DomainName $domainname -Credential $DACredential -Restart -Force -Verbose","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"sleep","state":"ACTIVE","attrs":{"script":"#script\nsleep(30)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"SQL Volume Labels","state":"ACTIVE","attrs":{"exit_status":[],"script":"# SQL Lettering\n\nGet-volume -DriveLetter E | Set-Volume -NewFileSystemLabel \"SQLUserDB\"\nGet-volume -DriveLetter F | Set-Volume -NewFileSystemLabel \"SQLTempDB\"\nGet-volume -DriveLetter G | Set-Volume -NewFileSystemLabel \"SQLUserLogs\"\nGet-volume -DriveLetter H | Set-Volume -NewFileSystemLabel \"SQLTempLogs\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install SQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"##################################\n##  SQL Install                 ##\n##################################\n\n# ref:  https:\/\/docs.microsoft.com\/en-us\/sql\/database-engine\/install-windows\/install-sql-server-using-sysprep?view=sql-server-ver15\n\n\n#Region Parameters\n\n#For production use, this should be parameterized or encrypted\n$SAPWD = \"@@{SAPWD}@@\"\n\n$SQLUSERDBDIR=\"E:\\MSSQL\\Data\"\n$SQLUSERDBLOGDIR=\"G:\\MSSQL\\Data\"\n$SQLTEMPDBDIR=\"F:\\MSSQL\\Data\"\n$SQLTEMPDBLOGDIR=\"H:\\MSSQL\\Data\"\n$INSTANCEDIR=\"d:\\Program Files\\Microsoft SQL Server\"\n$INSTALLSHAREDDIR=\"d:\\Program Files\\Microsoft SQL Server\"\n$INSTALLSHAREDWOWDIR=\"d:\\Program Files (x86)\\Microsoft SQL Server\"\n#EndRegion\n\n\n$configuration = @\"\n;SQL Server 2017 Configuration File\n[OPTIONS]\nIACCEPTPYTHONLICENSETERMS=\"False\"\nIACCEPTSQLSERVERLICENSETERMS=\"True\"\nACTION=\"CompleteImage\"\nSUPPRESSPRIVACYSTATEMENTNOTICE=\"True\"\nIACCEPTROPENLICENSETERMS=\"True\"\nENU=\"True\"\nQUIET=\"False\"\nQUIETSIMPLE=\"False\"\n;UIMODE=\"Normal\"\nUSEMICROSOFTUPDATE=\"True\"\nHELP=\"False\"\nINDICATEPROGRESS=\"False\"\nX86=\"False\"\nINSTANCENAME=\"MSSQLSERVER\"\nINSTANCEID=\"MSSQLSERVER\"\nSQLTELSVCACCT=\"NT Service\\SQLTELEMETRY\"\nSQLTELSVCSTARTUPTYPE=\"Automatic\"\nAGTSVCACCOUNT=\"NT Service\\SQLSERVERAGENT\"\nAGTSVCSTARTUPTYPE=\"Manual\"\nSQLSVCSTARTUPTYPE=\"Automatic\"\nFILESTREAMLEVEL=\"0\"\nENABLERANU=\"False\"\nSQLCOLLATION=\"SQL_Latin1_General_CP1_CI_AS\"\nSQLSVCACCOUNT=\"NT Service\\MSSQLSERVER\"\nSQLSVCINSTANTFILEINIT=\"False\"\nSQLSYSADMINACCOUNTS=\"BUILTIN\\Administrators\"\nSECURITYMODE=\"SQL\"\nSQLTEMPDBFILECOUNT=\"2\"\nSQLTEMPDBFILESIZE=\"8\"\nSQLTEMPDBFILEGROWTH=\"64\"\nSQLTEMPDBLOGFILESIZE=\"8\"\nSQLTEMPDBLOGFILEGROWTH=\"64\"\nINSTALLSQLDATADIR=\"D:\\Program Files\\Microsoft SQL Server\"\nSQLUSERDBDIR=$SQLUSERDBDIR\nSQLUSERDBLOGDIR=$SQLUSERDBLOGDIR\nSQLTEMPDBDIR=$SQLTEMPDBDIR\nSQLTEMPDBLOGDIR=$SQLTEMPDBLOGDIR\nADDCURRENTUSERASSQLADMIN=\"False\"\nTCPENABLED=\"0\"\nNPENABLED=\"0\"\nBROWSERSVCSTARTUPTYPE=\"Disabled\"\nFTSVCACCOUNT=\"NT Service\\MSSQLFDLauncher\"\n\"@\n\n$configuration | Out-File -FilePath c:\\SQLSysprep\\SQL_ConfigurationFile.INI -Encoding ascii -Force\n\n# Complete the sql install after the server has been sysprep'd\n#Invoke-Command {\n#    B:\\Setup.exe \/q \/SAPWD=$SAPWD \/ConfigurationFile=\"c:\\SQLSysprep\\SQL_ConfigurationFile.INI\"\n#}\n$Arguments = \"\/q \/SAPWD=$SAPWD \/ConfigurationFile=c:\\SQLSysprep\\SQL_ConfigurationFile.INI\"\n\nStart-Process -FilePath \"B:\\Setup.exe\" -ArgumentList $Arguments -Wait -Verb RunAs\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"SQL Firewall Rules","state":"ACTIVE","attrs":{"exit_status":[],"script":"#requires -version 4\n<#\n    .SYNOPSIS\n        Simple Script to install prerequisites for SQL AAG\n    .DESCRIPTION\n        This is one of the scripts in a series of scripts\n        that is intended for use in an automation sequence to \n        confiugre SQL Always On.\n\n        This script specifically sets the firewall rules\n\n    .NOTES\n        Version:        1.1\n        Author:         Dusty Lane\n        Creation Date:  06\/09\/2020\n        Purpose\/Change: add AAG port\n  \n#>\n\nNew-NetFirewallRule -DisplayName \"SQL Server - TCP 1433\" -Direction Inbound -Protocol TCP -LocalPort 1433 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Admin Connection - TCP 1434\" -Direction Inbound -Protocol TCP -LocalPort 1434 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Database Management - UDP 1434\" -Direction Inbound -Protocol UDP -LocalPort 1434 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Service Broker - TCP 4022\" -Direction Inbound -Protocol TCP -LocalPort 4022 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Debugger-RPC - TCP 135\" -Direction Inbound -Protocol TCP -LocalPort 135 -Action allow\nNew-NetFirewallRule -DisplayName \"SQL Browser - TCP 2382\" -Direction Inbound -Protocol TCP -LocalPort 2382 -Action allow\n# this next rule may need to be updated if the port is changed\nNew-NetFirewallRule -DisplayName \"SQL AAG - TCP 5022\" -Direction Inbound -Protocol TCP -LocalPort 5022 -Action allow","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Node2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Eject CDROM","state":"ACTIVE","attrs":{"exit_status":[],"script":"try { \n$CDROM = New-Object -ComObject \"Shell.Application\"\n$CDROM.Namespace(17).Items() | \n    Where-Object { $_.Type -eq \"CD Drive\" } | \n        foreach { $_.InvokeVerb(\"Eject\") }\n\n} catch { \n    $_\n} ","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"cae79b83_runbook_cloned_0_cloned_0","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ba5eb2b6_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Node2_Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"1ae97f3d_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"01c721d0_runbook_cloned_0_cloned_0","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"1ae97f3d_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"dd1c9949_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Node1_Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Node1"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"51367dbb_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Node2_Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Node2"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"AHV_Windows2019","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"Enter the FQDN name of the Active Directory Domain Name.  example:  contoso.com","data_type":"BASE","type":"LOCAL","name":"FQDN_Domain","value":"dustylane.local","label":"Domain Name","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"This is preferably AD integrated DNS Server IP address.","data_type":"BASE","type":"LOCAL","name":"DNSServer_IP","value":"172.16.2.25","label":"IP of DNS Server","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"SAPWD","value":"","label":"SQL SA Password","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"pe_ip","value":"172.16.2.40","label":"Prism Element IP","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"image_vm_disk_id","value":"add1c915-7575-4230-97a7-b192d68020a4","label":"ISO disk ID from Prism Element","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Creds_WINDOWS"},"type":"USER"},"name":"AHV_win2019gui_SQL2017std_AAG"},"api_version":"3.0","metadata":{"last_update_time":"1591815225188244","kind":"blueprint","spec_version":3,"creation_time":"1591813855018503","name":"AHV_win2019gui_SQL2017std_AAG"}}